
<p class="level0">
<p class="level0"><a name="NAME"></a><h2 class="nroffsh">NAME</h2>
<p class="level0">dpkg-shlibdeps - generate shared library substvar dependencies 
<p class="level0"><a name="SYNOPSIS"></a><h2 class="nroffsh">SYNOPSIS</h2>
<p class="level0"><span Class="bold">dpkg-shlibdeps</span> 
<p class="level0">
<p class="level0"><a name="DESCRIPTION"></a><h2 class="nroffsh">DESCRIPTION</h2>
<p class="level0"><span Class="bold">dpkg-shlibdeps</span> calculates shared library dependencies for executables named in its arguments. The dependencies are added to the substitution variables file <span Class="bold">debian/substvars</span> as variable names <span Class="bold">shlibs: dependency-field</span> where <span Class="emphasis">dependency-field</span> is a dependency field name. Any other variables starting with <span Class="bold">shlibs:</span> are removed from the file. 
<p class="level0"><span Class="bold">dpkg-shlibdeps</span> has two possible sources of information to generate dependency information. Either <span Class="emphasis">symbols</span> files or <span Class="emphasis">shlibs</span> files. For each binary that <span Class="bold">dpkg-shlibdeps</span> analyzes, it finds out the list of libraries that it's linked with. Then, for each library, it looks up either the <span Class="emphasis">symbols</span> file, or the <span Class="emphasis">shlibs</span> file (if the former doesn't exist or if debian/shlibs.local contains the relevant dependency). Both files are supposed to be provided by the library package and should thus be available as /var/lib/dpkg/info/<span Class="emphasis">package</span>.<span Class="emphasis">symbols</span> or /var/lib/dpkg/info/<span Class="emphasis">package</span>.<span Class="emphasis">shlibs</span>. The package name is identified in two steps: find the library file on the system (looking in the same directories that <span Class="bold">ld.so</span> would use), then use <span Class="bold">dpkg -S  library-file</span> to lookup the package providing the library. <a name="Symbols"></a><h2 class="nroffsh">Symbols files</h2>
<p class="level0">Symbols files contain finer-grained dependency information by providing the minimum dependency for each symbol that the library exports. The script tries to find a symbols file associated to a library package in the following places (first match is used): 
<p class="level0"><a name="debianDEBIANsymbols"></a><span class="nroffip">debian/*/DEBIAN/symbols</span> 
<p class="level1">Shared library information generated by the current build process that also invoked <span Class="manpage">dpkg-shlibdeps .</span>They are generated by <span Class="manpage">dpkg-gensymbols (1).</span>They are only used if the library is found in a package's build tree. The symbols file in that build tree takes precedence over symbols files from other binary packages. 
<p class="level0"><a name="etcdpkgsymbolsfIpackagefRsymbolsfIarchfR"></a><span class="nroffip">/etc/dpkg/symbols/\fIpackage\fR.symbols.\fIarch\fR</span> 
<p class="level1">
<p class="level0"><a name="etcdpkgsymbolsfIpackagefRsymbols"></a><span class="nroffip">/etc/dpkg/symbols/\fIpackage\fR.symbols</span> 
<p class="level1">Per-system overriding shared library dependency information. <span Class="emphasis">arch</span> is the architecture of the current system (obtained by <span Class="manpage">dpkg-architecture -qDEB_HOST_ARCH ).</span>
<p class="level0"><a name="Output"></a><span class="nroffip">Output from \(lq\fBdpkg-query --control-path\fR \fIpackage\fR symbols\(rq</span> 
<p class="level1">Package-provided shared library dependency information. Unless overridden by <span Class="bold">--admindir</span>, those files are located in /var/lib/dpkg. 
<p class="level1">While scanning the symbols used by all binaries, <span Class="bold">dpkg-shlibdeps</span> remembers the (biggest) minimal version needed for each library. At the end of the process, it is able to write out the minimal dependency for every library used (provided that the information of the <span Class="emphasis">symbols</span> files are accurate). 
<p class="level1">As a safe-guard measure, a symbols file can provide a <span Class="bold">Build-Depends-Package</span> meta-information field and <span Class="bold">dpkg-shlibdeps</span> will extract the minimal version required by the corresponding package in the <span Class="bold">Build-Depends</span> field and use this version if it's higher than the minimal version computed by scanning symbols. <a name="Shlibs"></a><h2 class="nroffsh">Shlibs files</h2>
<p class="level0">Shlibs files associate directly a library to a dependency (without looking at the symbols). It's thus often stronger than really needed but very safe and easy to handle. 
<p class="level0">The dependencies for a library are looked up in several places. The first file providing information for the library of interest is used: 
<p class="level0"><a name="debianshlibslocal"></a><span class="nroffip">debian/shlibs.local</span> 
<p class="level1">Package-local overriding shared library dependency information. 
<p class="level0"><a name="etcdpkgshlibsoverride"></a><span class="nroffip">/etc/dpkg/shlibs.override</span> 
<p class="level1">Per-system overriding shared library dependency information. 
<p class="level0"><a name="debianDEBIANshlibs"></a><span class="nroffip">debian/*/DEBIAN/shlibs</span> 
<p class="level1">Shared library information generated by the current build process that also invoked <span Class="manpage">dpkg-shlibdeps .</span>They are only used if the library is found in a package's build tree. The shlibs file in that build tree takes precedence over shlibs files from other binary packages. 
<p class="level0"><a name="Output"></a><span class="nroffip">Output from \(lq\fBdpkg-query --control-path\fP \fIpackage\fR shlibs\(rq</span> 
<p class="level1">Package-provided shared library dependency information. Unless overridden by <span Class="bold">--admindir</span>, those files are located in /var/lib/dpkg. 
<p class="level0"><a name="etcdpkgshlibsdefault"></a><span class="nroffip">/etc/dpkg/shlibs.default</span> 
<p class="level1">Per-system default shared library dependency information. 
<p class="level1">The extracted dependencies are then directly used (except if they are filtered out because they have been identified as duplicate, or as weaker than another dependency). <a name="OPTIONS"></a><h2 class="nroffsh">OPTIONS</h2>
<p class="level0"><span Class="bold">dpkg-shlibdeps</span> interprets non-option arguments as executable names, just as if they'd been supplied as <span Class="bold">-e executable.</span> 
<p class="level0"><span Class="bold">-e executable</span> Include dependencies appropriate for the shared libraries required by <span Class="emphasis">executable .</span> This option can be used multiple times. 
<p class="level0"><span Class="bold">-l directory</span> Add <span Class="emphasis">directory</span> to the list of directories to search for private shared libraries (since dpkg 1.17.0). This option can be used multiple times. 
<p class="level0">Note: Use this option instead of setting <span Class="bold">LD_LIBRARY_PATH</span>, as that environment variable is used to control the run-time linker and abusing it to set the shared library paths at build-time can be problematic when cross-compiling for example. 
<p class="level0"><span Class="bold">-d dependency-field</span> Add dependencies to be added to the control file dependency field <span Class="emphasis">dependency-field .</span> (The dependencies for this field are placed in the variable <span Class="bold">shlibs: dependency-field.)</span> 
<p class="level0">The <span Class="bold">-d dependency-field</span> option takes effect for all executables after the option, until the next <span Class="bold">-d dependency-field.</span> The default <span Class="emphasis">dependency-field</span> is <span Class="manpage">Depends .</span>
<p class="level0">If the same dependency entry (or set of alternatives) appears in more than one of the recognized dependency field names <span Class="manpage">Pre-Depends</span>, <span Class="manpage">Depends</span>, <span Class="manpage">Recommends</span>, <span Class="manpage">Enhances  or  Suggests</span>then <span Class="bold">dpkg-shlibdeps</span> will automatically remove the dependency from all fields except the one representing the most important dependencies. 
<p class="level0"><span Class="bold">-p varname-prefix</span> Start substitution variables with 
<p class="level0">instead of <span Class="manpage">shlibs: .</span>Likewise, any existing substitution variables starting with 
<p class="level0">(rather than <span Class="manpage">shlibs: )</span>are removed from the the substitution variables file. 
<p class="level0"><span Class="manpage">-O [\fIfilename\fP]</span>Print substitution variable settings to standard output (or <span Class="emphasis">filename</span> if specified), rather than being added to the substitution variables file 
<p class="level0">by default). 
<p class="level0"><span Class="bold">-t type</span> Prefer shared library dependency information tagged for the given package type. If no tagged information is available, falls back to untagged information. The default package type is "deb". Shared library dependency information is tagged for a given type by prefixing it with the name of the type, a colon, and whitespace. 
<p class="level0"><span Class="bold">-L local-shlibs-file</span> Read overriding shared library dependency information from <span Class="emphasis">local-shlibs-file</span> instead of <a class="manpage" href="#debianshlibslocal">debian/shlibs.local .</a>
<p class="level0"><span Class="bold">-T substvars-file</span> Write substitution variables in <span Class="emphasis">substvars-file ;</span> the default is <span Class="manpage">debian/substvars .</span>
<p class="level0"><span Class="bold">-v</span> Enable verbose mode. Numerous messages are displayed to explain what <span Class="bold">dpkg-shlibdeps</span> does. 
<p class="level0"><span Class="bold">-x package</span> Exclude the package from the generated dependencies. This is useful to avoid self-dependencies for packages which provide ELF binaries (executables or library plugins) using a library contained in the same package. This option can be used multiple times to exclude several packages. 
<p class="level0"><span Class="bold">-S package-build-dir</span> Look into <span Class="emphasis">package-build-dir</span> first when trying to find a library. This is useful when the source package builds multiple flavors of the same library and you want to ensure that you get the dependency from a given binary package. You can use this option multiple times: directories will be tried in the same order before directories of other binary packages. 
<p class="level0"><span Class="bold">--ignore-missing-info</span> Do not fail if dependency information can't be found for a shared library. Usage of this option is discouraged, all libraries should provide dependency information (either with shlibs files, or with symbols files) even if they are not yet used by other packages. 
<p class="level0"><span Class="bold">--warnings= value</span> <span Class="emphasis">value</span> is a bit field defining the set of warnings that can be emitted by <span Class="bold">dpkg-shlibdeps</span>. Bit 0 (value=1) enables the warning "symbol <span Class="emphasis">sym</span> used by <span Class="emphasis">binary</span> found in none of the libraries", bit 1 (value=2) enables the warning "package could avoid a useless dependency" and bit 2 (value=4) enables the warning "<span Class="emphasis">binary</span> should not be linked against <span Class="emphasis">library</span>". The default <span Class="emphasis">value</span> is 3: the first two warnings are active by default, the last one is not. Set <span Class="emphasis">value</span> to 7 if you want all warnings to be active. 
<p class="level0"><span Class="bold">--admindir= dir</span> Change the location of the <span Class="bold">dpkg</span> database. The default location is <span Class="emphasis">/var/lib/dpkg</span>. 
<p class="level0"><span Class="manpage">-?</span>, <span Class="manpage">--help</span>Show the usage message and exit. 
<p class="level0"><span Class="manpage">--version</span>Show the version and exit. 
<p class="level0"><a name="DIAGNOSTICS"></a><h2 class="nroffsh">DIAGNOSTICS</h2>
<p class="level0"><a name="Warnings"></a><h2 class="nroffsh">Warnings</h2>
<p class="level0">Since <span Class="bold">dpkg-shlibdeps</span> analyzes the set of symbols used by each binary of the generated package, it is able to emit warnings in several cases. They inform you of things that can be improved in the package. In most cases, those improvements concern the upstream sources directly. By order of decreasing importance, here are the various warnings that you can encounter: 
<p class="level0"><span Class="bold">symbol  sym  used by  binary  found in none of the libraries.</span> The indicated symbol has not been found in the libraries linked with the binary. The <span Class="emphasis">binary</span> is most likely a library and it needs to be linked with an additional library during the build process (option <span Class="bold">-l</span><span Class="emphasis">library</span> of the linker). 
<p class="level0">
<p class="level0">The indicated symbol has not been found in the libraries linked with the binary. The <span Class="emphasis">binary</span> is most likely a plugin and the symbol is probably provided by the program that loads this plugin. In theory a plugin doesn't have any SONAME but this binary does have one and as such it could not be clearly identified as such. However the fact that the binary is stored in a non-public directory is a strong indication that's it's not a normal shared library. If the binary is really a plugin, then disregard this warning. But there's always the possibility that it's a real library and that programs linking to it are using an RPATH so that the dynamic loader finds it. In that case, the library is broken and needs to be fixed. 
<p class="level0"><span Class="bold">package could avoid a useless dependency if  binary  was not linked against  library  (it uses none of the library's symbols)</span> None of the <span Class="emphasis">binaries</span> that are linked with </span>library</span> use any of the symbols provided by the library. By fixing all the binaries, you would avoid the dependency associated to this library (unless the same dependency is also generated by another library that is really used). 
<p class="level0"><span Class="bold">package could avoid a useless dependency if  binaries  were not linked against  library  (they uses none of the library's symbols)</span> Exactly the same as the above warning, but for multiple binaries. 
<p class="level0">
<p class="level0">The <span Class="emphasis">binary</span> is linked to a library that it doesn't need. It's not a problem but some small performance improvements in binary load time can be obtained by not linking this library to this binary. This warning checks the same information than the previous one but does it for each binary instead of doing the check globally on all binaries analyzed. <a name="Errors"></a><h2 class="nroffsh">Errors</h2>
<p class="level0"><span Class="bold">dpkg-shlibdeps</span> will fail if it can't find a public library used by a binary or if this library has no associated dependency information (either shlibs file or symbols file). A public library has a SONAME and is versioned (libsomething.so.<span Class="emphasis">X</span>). A private library (like a plugin) should not have a SONAME and doesn't need to be versioned. 
<p class="level0"><span Class="bold">couldn't find library  library-soname  needed by  binary  (its RPATH is ' rpath ')</span> The <span Class="emphasis">binary</span> uses a library called <span Class="emphasis">library-soname</span> but <span Class="bold">dpkg-shlibdeps</span> has been unable to find the library. <span Class="bold">dpkg-shlibdeps</span> creates a list of directories to check as following: directories listed in the RPATH of the binary, directories listed in /etc/ld.so.conf, directories added by the <span Class="bold">-l</span> option, directories listed in the <span Class="bold">LD_LIBRARY_PATH</span> environment variable, and standard public directories (/lib, /usr/lib, /lib32, /usr/lib32, /lib64, /usr/lib64). Then it checks those directories in the package's build tree of the binary being analyzed, in the packages' build trees indicated with the <span Class="bold">-S</span> command-line option, in other packages' build trees that contains a DEBIAN/shlibs or DEBIAN/symbols file and finally in the root directory. If the library is not found in any of those directories, then you get this error. 
<p class="level0">If the library not found is in a private directory of the same package, then you want to add the directory with <span Class="bold">-l</span>. If it's in another binary package being built, you want to make sure that the shlibs/symbols file of this package is already created and that <span Class="bold">-l</span> contains the appropriate directory if it also is in a private directory. 
<p class="level0"><span Class="bold">no dependency information found for  library-file  (used by  binary ).</span> The library needed by <span Class="emphasis">binary</span> has been found by <span Class="bold">dpkg-shlibdeps</span> in <span Class="emphasis">library-file</span> but <span Class="bold">dpkg-shlibdeps</span> has been unable to find any dependency information for that library. To find out the dependency, it has tried to map the library to a Debian package with the help of <span Class="bold">dpkg -S  library-file.</span> Then it checked the corresponding shlibs and symbols files in /var/lib/dpkg/info/, and in the various package's build trees (debian/*/DEBIAN/). 
<p class="level0">This failure can be caused by a bad or missing shlibs or symbols file in the package of the library. It might also happen if the library is built within the same source package and if the shlibs files has not yet been created (in which case you must fix debian/rules to create the shlibs before calling <span Class="bold">dpkg-shlibdeps</span>). Bad RPATH can also lead to the library being found under a non-canonical name (example: /usr/lib/openoffice.org/../lib/libssl.so.0.9.8 instead of /usr/lib/libssl.so.0.9.8) that's not associated to any package, <span Class="bold">dpkg-shlibdeps</span> tries to work around this by trying to fallback on a canonical name (using <span Class="manpage">realpath (3))</span>but it might not always work. It's always best to clean up the RPATH of the binary to avoid problems. 
<p class="level0">Calling <span Class="bold">dpkg-shlibdeps</span> in verbose mode (<span Class="bold">-v</span>) will provide much more information about where it tried to find the dependency information. This might be useful if you don't understand why it's giving you this error. <a name="SEE"></a><h2 class="nroffsh">SEE ALSO</h2>
<p class="level0"><span Class="manpage">deb-shlibs (5)</span>, <span Class="manpage">deb-symbols (5)</span>, <span Class="manpage">dpkg-gensymbols (1).</span>