
<p class="level0">
<p class="level0">
<p class="level0"><pre class="level0">
</pre>

<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">'br} 
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">'br} 
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">{\ 
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0">
<p class="level0"><a name="NAME"></a><h2 class="nroffsh">NAME</h2>
<p class="level0">enc2xs -- Perl Encode Module Generator <a name="SYNOPSIS"></a><h2 class="nroffsh">SYNOPSIS</h2>
<p class="level0">
<p class="level0">
<p class="level0">&nbsp; enc2xs -[options] &nbsp; enc2xs -M ModName mapfiles... &nbsp; enc2xs -C 
<p class="level0"><a name="DESCRIPTION"></a><h2 class="nroffsh">DESCRIPTION</h2>
<p class="level0">
<p class="level0"><span Class="emphasis">enc2xs</span> builds a Perl extension for use by Encode from either Unicode Character Mapping files (.ucm) or Tcl Encoding Files (.enc). Besides being used internally during the build process of the Encode module, you can use <span Class="emphasis">enc2xs</span> to add your own encoding to perl. No knowledge of s-1XSs0 is necessary. <a name="Quick"></a><h2 class="nroffsh">Quick Guide</h2>
<p class="level0">
<p class="level0">If you want to know as little about Perl as possible but need to add a new encoding, just read this chapter and forget the rest. 
<p class="level0"><a name="0"></a><span class="nroffip">0. 4</span> 
<p class="level1">
<p class="level1">Have a .ucm file ready.  You can get it from somewhere or you can write your own from scratch or you can grab one from the Encode distribution and customize it.  For the s-1UCMs0 format, see the next Chapter.  In the example below, I'll call my theoretical encoding myascii, defined in <span Class="emphasis">my.ucm</span>.  f(CW*(C`$*(C'</span> is a shell prompt. 
<p class="level1">
<p class="level1">&nbsp; $ ls -F &nbsp; my.ucm 
<p class="level1">
<p class="level0"><a name="1"></a><span class="nroffip">1. 4</span> 
<p class="level1">
<p class="level1">Issue a command as follows; 
<p class="level1">
<p class="level1">&nbsp; $ enc2xs -M My my.ucm &nbsp; generating Makefile.PL &nbsp; generating My.pm &nbsp; generating README &nbsp; generating Changes 
<p class="level1">
<p class="level1">Now take a look at your current directory.  It should look like this. 
<p class="level1">
<p class="level1">&nbsp; $ ls -F &nbsp; Makefile.PL   My.pm         my.ucm        t/ 
<p class="level1">
<p class="level1">The following files were created. 
<p class="level1">
<p class="level1">&nbsp; Makefile.PL - MakeMaker script &nbsp; My.pm       - Encode submodule &nbsp; t/My.t      - test file 
<p class="level1">
<p class="level2">
<p class="level1"><a name="11"></a><span class="nroffip">1.1. 4</span> 
<p class="level2">
<p class="level2">If you want *.ucm installed together with the modules, do as follows; 
<p class="level2">
<p class="level2">&nbsp; $ mkdir Encode &nbsp; $ mv *.ucm Encode &nbsp; $ enc2xs -M My Encode/*ucm 
<p class="level2">
<p class="level1">
<p class="level2">
<p class="level1">
<p class="level0"><a name="2"></a><span class="nroffip">2. 4</span> 
<p class="level1">
<p class="level1">Edit the files generated.  You don't have to if you have no time s-1ANDs0 no intention to give it to someone else.  But it is a good idea to edit the pod and to add more tests. 
<p class="level0"><a name="3"></a><span class="nroffip">3. 4</span> 
<p class="level1">
<p class="level1">Now issue a command all Perl Mongers love: 
<p class="level1">
<p class="level1">&nbsp; $ perl Makefile.PL &nbsp; Writing Makefile for Encode::My 
<p class="level1">
<p class="level0"><a name="4"></a><span class="nroffip">4. 4</span> 
<p class="level1">
<p class="level1">Now all you have to do is make. 
<p class="level1">
<p class="level1">&nbsp; $ make &nbsp; cp My.pm blib/lib/Encode/My.pm &nbsp; /usr/local/bin/perl /usr/local/bin/enc2xs -Q -O e &nbsp;   -o encode_t.c -f encode_t.fnm &nbsp; Reading myascii (myascii) &nbsp; Writing compiled form &nbsp; 128 bytes in string tables &nbsp; 384 bytes (75%) saved spotting duplicates &nbsp; 1 bytes (0.775%) saved using substrings &nbsp; .... &nbsp; chmod 644 blib/arch/auto/Encode/My/My.bs &nbsp; $ 
<p class="level1">
<p class="level1">The time it takes varies depending on how fast your machine is and how large your encoding is.  Unless you are working on something big like euc-tw, it won't take too long. 
<p class="level0"><a name="5"></a><span class="nroffip">5. 4</span> 
<p class="level1">
<p class="level1">You can *(L"make install*(R" already but you should test first. 
<p class="level1">
<p class="level1">&nbsp; $ make test &nbsp; PERL_DL_NONLAZY=1 /usr/local/bin/perl -Iblib/arch -Iblib/lib e &nbsp;   -e *(Aquse Test::Harness  qw(&runtests $verbose); e &nbsp;   $verbose=0; runtests @ARGV;*(Aq t/*.t &nbsp; t/My....ok &nbsp; All tests successful. &nbsp; Files=1, Tests=2,  0 wallclock secs &nbsp;  ( 0.09 cusr + 0.01 csys = 0.09 CPU) 
<p class="level1">
<p class="level0"><a name="6"></a><span class="nroffip">6. 4</span> 
<p class="level1">
<p class="level1">If you are content with the test result, just *(L"make install*(R" 
<p class="level0"><a name="7"></a><span class="nroffip">7. 4</span> 
<p class="level1">
<p class="level1">If you want to add your encoding to Encode's demand-loading list (so you don't have to *(L"use Encode::YourEncoding*(R"), run 
<p class="level1">
<p class="level1">&nbsp; enc2xs -C 
<p class="level1">
<p class="level1">to update Encode::ConfigLocal, a module that controls local settings. After that, *(L"use Encode;*(R" is enough to load your encodings on demand. <a name="The"></a><h2 class="nroffsh">The Unicode Character Map</h2>
<p class="level0">
<p class="level0">Encode uses the Unicode Character Map (s-1UCMs0) format for source character mappings.  This format is used by s-1IBMs0's s-1ICUs0 package and was adopted by Nick Ing-Simmons for use with the Encode module.  Since s-1UCMs0 is more flexible than Tcl's Encoding Map and far more user-friendly, this is the recommended format for Encode now. 
<p class="level0">A s-1UCMs0 file looks like this. 
<p class="level0">
<p class="level0">&nbsp; &#35; &nbsp; &#35; Comments &nbsp; &#35; &nbsp; &lt;code_set_name&gt; "US-ascii" &#35; Required &nbsp; &lt;code_set_alias&gt; "ascii"   &#35; Optional &nbsp; &lt;mb_cur_min&gt; 1             &#35; Required; usually 1 &nbsp; &lt;mb_cur_max&gt; 1             &#35; Max. &#35; of bytes/char &nbsp; &lt;subchar&gt; ex3F             &#35; Substitution char &nbsp; &#35; &nbsp; CHARMAP &nbsp; &lt;U0000&gt; ex00 |0 &#35; &lt;control&gt; &nbsp; &lt;U0001&gt; ex01 |0 &#35; &lt;control&gt; &nbsp; &lt;U0002&gt; ex02 |0 &#35; &lt;control&gt; &nbsp; .... &nbsp; &lt;U007C&gt; ex7C |0 &#35; VERTICAL LINE &nbsp; &lt;U007D&gt; ex7D |0 &#35; RIGHT CURLY BRACKET &nbsp; &lt;U007E&gt; ex7E |0 &#35; TILDE &nbsp; &lt;U007F&gt; ex7F |0 &#35; &lt;control&gt; &nbsp; END CHARMAP 
<p class="level0">
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">Anything that follows f(CW*(C`&#35;*(C'</span> is treated as a comment. 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">The header section continues until a line containing the word s-1CHARMAP.s0 This section has a form of <span Class="emphasis">&lt;keyword&gt; value</span>, one pair per line.  Strings used as values must be quoted. Barewords are treated as numbers.  <span Class="emphasis">exXX</span> represents a byte. 
<p class="level1">Most of the keywords are self-explanatory. <span Class="emphasis">subchar</span> means substitution character, not subcharacter.  When you decode a Unicode sequence to this encoding but no matching character is found, the byte sequence defined here will be used.  For most cases, the value here is ex3F; in s-1ASCII,s0 this is a question mark. 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">s-1CHARMAPs0 starts the character map section.  Each line has a form as follows: 
<p class="level1">
<p class="level1">&nbsp; &lt;UXXXX&gt; exXX.. |0 &#35; comment &nbsp;   ^     ^      ^ &nbsp;   |     |      +- Fallback flag &nbsp;   |     +-------- Encoded byte sequence &nbsp;   +-------------- Unicode Character ID in hex 
<p class="level1">
<p class="level1">The format is roughly the same as a header section except for the fallback flag: | followed by 0..3.   The meaning of the possible values is as follows: 
<p class="level2">
<p class="level1"><a name="0"></a><span class="nroffip">|0 4</span> 
<p class="level2">
<p class="level2">Round trip safe.  A character decoded to Unicode encodes back to the same byte sequence.  Most characters have this flag. 
<p class="level1"><a name="1"></a><span class="nroffip">|1 4</span> 
<p class="level2">
<p class="level2">Fallback for unicode -&gt; encoding.  When seen, enc2xs adds this character for the encode map only. 
<p class="level1"><a name="2"></a><span class="nroffip">|2 4</span> 
<p class="level2">
<p class="level2">Skip sub-char mapping should there be no code point. 
<p class="level1"><a name="3"></a><span class="nroffip">|3 4</span> 
<p class="level2">
<p class="level2">Fallback for encoding -&gt; unicode.  When seen, enc2xs adds this character for the decode map only. 
<p class="level1">
<p class="level2">
<p class="level1">
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">And finally, s-1END OF CHARMAPs0 ends the section. 
<p class="level1">When you are manually creating a s-1UCMs0 file, you should copy ascii.ucm or an existing encoding which is close to yours, rather than write your own from scratch. 
<p class="level1">When you do so, make sure you leave at least <span Class="bold">U0000</span> to <span Class="bold">U0020</span> as is, unless your environment is s-1EBCDIC.s0 
<p class="level1"><span Class="bold">s-1CAVEATs0</span>: not all features in s-1UCMs0 are implemented.  For example, icu:state is not used.  Because of that, you need to write a perl module if you want to support algorithmical encodings, notably the s-1ISO-2022s0 series.  Such modules include Encode::JP::2022_JP, Encode::KR::2022_KR, and Encode::TW::HZ. <a name="Coping"></a><h2 class="nroffsh">Coping with duplicate mappings</h2>
<p class="level0">
<p class="level0">When you create a map, you s-1SHOULDs0 make your mappings round-trip safe. That is, f(CW*(C`encode(*(Aqyour-encoding*(Aq, decode(*(Aqyour-encoding*(Aq, $data)) eq $data*(C'</span> stands for all characters that are marked as f(CW*(C`|0*(C'</span>.  Here is how to make sure: 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">Sort your map in Unicode order. 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">When you have a duplicate entry, mark either one with '|1' or '|3'. 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">And make sure the '|1' or '|3' entry s-1FOLLOWSs0 the '|0' entry. 
<p class="level1">Here is an example from big5-eten. 
<p class="level1">
<p class="level1">&nbsp; &lt;U2550&gt; exF9exF9 |0 &nbsp; &lt;U2550&gt; exA2exA4 |3 
<p class="level1">
<p class="level1">Internally Encoding -&gt; Unicode and Unicode -&gt; Encoding Map looks like this; 
<p class="level1">
<p class="level1">&nbsp; E to U               U to E &nbsp; -------------------------------------- &nbsp; exF9exF9 =&gt; U2550    U2550 =&gt; exF9exF9 &nbsp; exA2exA4 =&gt; U2550 
<p class="level1">
<p class="level1">So it is round-trip safe for exF9exF9.  But if the line above is upside down, here is what happens. 
<p class="level1">
<p class="level1">&nbsp; E to U               U to E &nbsp; -------------------------------------- &nbsp; exA2exA4 =&gt; U2550    U2550 =&gt; exF9exF9 &nbsp; (exF9exF9 =&gt; U2550 is now overwritten!) 
<p class="level1">
<p class="level1">The Encode package comes with <span Class="emphasis">ucmlint</span>, a crude but sufficient utility to check the integrity of a s-1UCMs0 file.  Check under the Encode/bin directory for this. 
<p class="level1">When in doubt, you can use <span Class="emphasis">ucmsort</span>, yet another utility under Encode/bin directory. <a name="Bookmarks"></a><h2 class="nroffsh">Bookmarks</h2>
<p class="level0">
<p class="level0">
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">s-1ICUs0 Home Page  &lt;http://www.icu-project.org/&gt; 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">s-1ICUs0 Character Mapping Tables &lt;http://site.icu-project.org/charts/charset&gt; 
<p class="level0"><a name="bu"></a><span class="nroffip">\(bu 4</span> 
<p class="level1">ICU:Conversion Data &lt;http://www.icu-project.org/userguide/conversion-data.html&gt; <a name="SEE"></a><h2 class="nroffsh">SEE ALSO</h2>
<p class="level0">
<p class="level0">Encode, perlmod, perlpod 